# CDM QR Access Control System - å°ˆæ¡ˆèªªæ˜æ–‡ä»¶

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

CDM QR Access Control System æ˜¯ä¸€å¥—å®Œæ•´çš„é–€ç¦ç®¡ç†ç³»çµ±,æ•´åˆäº† QR Code é€šè¡Œç®¡ç†ã€èª²ç¨‹æ’ç¨‹ã€ç°½åˆ°ç®¡ç†ç­‰åŠŸèƒ½ã€‚ç³»çµ±æ¡ç”¨å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹,å¾Œç«¯ä½¿ç”¨ ASP.NET Core,å‰ç«¯ä½¿ç”¨ Vue 3 + TypeScriptã€‚

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æŠ€è¡“å †ç–Š

**å¾Œç«¯ (Backend)**
- **æ¡†æ¶**: ASP.NET Core (.NET)
- **è³‡æ–™åº«**: MySQL (ä½¿ç”¨ Entity Framework Core)
- **é©—è­‰æ©Ÿåˆ¶**: JWT (JSON Web Token)
- **æ’ç¨‹ä»»å‹™**: Quartz.NET
- **æ—¥èªŒè¨˜éŒ„**: NLog
- **API æ–‡ä»¶**: Swagger

**å‰ç«¯ (Frontend)**
- **æ¡†æ¶**: Vue 3 + TypeScript
- **UI å‡½å¼åº«**: Element Plus
- **æ—¥æ›†å…ƒä»¶**: FullCalendar
- **å»ºæ§‹å·¥å…·**: Vite / Babel

**æ•´åˆæœå‹™**
- **é–€ç¦ç¡¬é«”æ•´åˆ**: Soyal API (ç´¢äºé–€ç¦ç³»çµ±)

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
CDM_QR-Access-Control-System/
â”œâ”€â”€ DoorWebApp/              # ASP.NET Core å¾Œç«¯æ‡‰ç”¨ç¨‹å¼
â”‚   â”œâ”€â”€ Controllers/         # API æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ Models/             # è³‡æ–™æ¨¡å‹èˆ‡ DTO
â”‚   â”œâ”€â”€ Extensions/         # æ“´å……å‡½å¼
â”‚   â”œâ”€â”€ Properties/         # å°ˆæ¡ˆå±¬æ€§
â”‚   â”œâ”€â”€ wwwroot/           # éœæ…‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ Program.cs         # æ‡‰ç”¨ç¨‹å¼é€²å…¥é»
â”‚   â”œâ”€â”€ ScheduledJob.cs    # æ’ç¨‹ä»»å‹™ (QR Code æ›´æ–°)
â”‚   â”œâ”€â”€ JWTHelper.cs       # JWT è¼”åŠ©é¡åˆ¥
â”‚   â”œâ”€â”€ AuditLogWritter.cs # ç¨½æ ¸æ—¥èªŒè¨˜éŒ„å™¨
â”‚   â””â”€â”€ appsettings.json   # æ‡‰ç”¨ç¨‹å¼è¨­å®š
â”‚
â”œâ”€â”€ DoorDB/                 # è³‡æ–™åº«å±¤ (Entity Framework)
â”‚   â”œâ”€â”€ DoorDbContext.cs   # è³‡æ–™åº«ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ Migrations/        # è³‡æ–™åº«é·ç§»æª”æ¡ˆ
â”‚   â”œâ”€â”€ Enums/            # åˆ—èˆ‰å®šç¾©
â”‚   â””â”€â”€ Tbl*.cs           # è³‡æ–™è¡¨å¯¦é«”é¡åˆ¥
â”‚
â”œâ”€â”€ DoorWebApp_Vue/         # Vue å‰ç«¯æ‡‰ç”¨ç¨‹å¼
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/         # é é¢å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ components/    # å…±ç”¨å…ƒä»¶
â”‚   â”‚   â”œâ”€â”€ models/        # TypeScript æ¨¡å‹
â”‚   â”‚   â””â”€â”€ apis/          # API å‘¼å«å±¤
â”‚   â”œâ”€â”€ public/            # å…¬é–‹è³‡æº
â”‚   â””â”€â”€ package.json       # npm ç›¸ä¾å¥—ä»¶
â”‚
â”œâ”€â”€ docs/                   # å°ˆæ¡ˆæ–‡ä»¶
â””â”€â”€ api/                    # API ç›¸é—œæ–‡ä»¶
    â””â”€â”€ routes/            # API è·¯ç”±èªªæ˜
```

## ğŸ”‘ æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

### 1. ä½¿ç”¨è€…ç®¡ç†æ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- ä½¿ç”¨è€…å¸³è™Ÿå»ºç«‹ã€æ›´æ–°ã€åˆªé™¤ (CRUD)
- è§’è‰²æ¬Šé™ç®¡ç† (Role-Based Access Control)
- å­å¸³è™Ÿç®¡ç† (å®¶é•·-å­¸ç”Ÿé—œè¯)
- ä½¿ç”¨è€…èº«åˆ†é©—è­‰èˆ‡æˆæ¬Š

**ç›¸é—œ API**
- `POST /api/v1/User/login` - ä½¿ç”¨è€…ç™»å…¥
- `POST /api/v1/Users` - å–å¾—ä½¿ç”¨è€…æ¸…å–®
- `GET /api/v1/UsersOptions` - å–å¾—ä½¿ç”¨è€…ä¸‹æ‹‰é¸å–®
- `GET /api/v1/User/{id}` - å–å¾—å–®ä¸€ä½¿ç”¨è€…è³‡è¨Š
- `POST /api/v1/User` - æ–°å¢ä½¿ç”¨è€…
- `PUT /api/v1/User` - æ›´æ–°ä½¿ç”¨è€…è³‡è¨Š
- `POST /api/v1/User/SubAccount` - æ–°å¢å­å¸³è™Ÿ
- `DELETE /api/v1/User/SubAccount` - ç§»é™¤å­å¸³è™Ÿ
- `POST /api/v1/User/ForgotPassword` - å¿˜è¨˜å¯†ç¢¼

**è³‡æ–™è¡¨**
- `TblUser` - ä½¿ç”¨è€…åŸºæœ¬è³‡è¨Š
- `TblRole` - è§’è‰²å®šç¾©

### 2. é–€ç¦æ¬Šé™ç®¡ç†æ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- å–®æ™‚æ®µé–€ç¦è¨­å®š (å›ºå®šæ™‚æ®µé€šè¡Œ)
- å¤šæ™‚æ®µé–€ç¦è¨­å®š (å½ˆæ€§æ™‚æ®µè¦åŠƒ)
- é–€ç¦ç¾¤çµ„ç®¡ç†
- é€šè¡Œæ™‚é–“è¨­å®š (æ—¥æœŸå€é–“ã€æ˜ŸæœŸã€æ™‚æ®µ)
- QR Code è‡ªå‹•ç”¢ç”Ÿèˆ‡æ›´æ–°

**ç›¸é—œ API**
- `GET /api/v1/User/Permission/{userId}` - å–å¾—ä½¿ç”¨è€…é–€ç¦è¨­å®šåŠ QRcode
- `POST /api/v1/Permission` - è¨­å®šä½¿ç”¨è€…é€šè¡Œè³‡æ–™
- `GET /api/v1/Permission/{userId}` - å–å¾—ä½¿ç”¨è€…é€šè¡Œè³‡æ–™
- `POST /api/v1/StudentPermissions` - å–å¾—é–€ç¦ä½¿ç”¨è€…æ¸…å–® (å¤šæ™‚æ®µ)
- `POST /api/v1/StudentPermission` - æ–°å¢ä½¿ç”¨è€…é–€ç¦è¨­å®š (å¤šæ™‚æ®µ)
- `PUT /api/v1/StudentPermission` - æ›´æ–°ä½¿ç”¨è€…é–€ç¦è¨­å®š (å¤šæ™‚æ®µ)
- `GET /api/v1/StudentPermission/{id}` - å–å¾—é–€ç¦å–®ä¸€ä½¿ç”¨è€… (å¤šæ™‚æ®µ)
- `POST /api/v1/Permission/SetAll` - æ‰‹å‹•è¨­å®šç•¶å¤©æ‰€æœ‰é–€ç¦
- `PUT /api/v1/Permission/UpdateTime` - æ›´æ–°å–®ä¸€ä½¿ç”¨è€…é–€ç¦æ™‚é–“

**è³‡æ–™è¡¨**
- `TblPermission` - é–€ç¦æ¬Šé™è¨­å®š (å–®æ™‚æ®µ)
- `TblStudentPermission` - å­¸ç”Ÿé–€ç¦æ¬Šé™ (å¤šæ™‚æ®µ)
- `TblPermissionGroup` - é–€ç¦ç¾¤çµ„
- `TblQRCodeStorage` - QR Code å„²å­˜

**æ’ç¨‹ä»»å‹™**
- `ScheduledJob.cs` - æ¯ 9 åˆ† 45 ç§’åŸ·è¡Œä¸€æ¬¡,
è‡ªå‹•æ›´æ–°ç¬¦åˆæ¢ä»¶çš„ QR Code 
EX: 09:09:45 09:19:45 09:29:45 09:39:45 09:49:45 09:59:45

### 3. QR Code ç®¡ç†æ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- å‹•æ…‹ QR Code ç”¢ç”Ÿ
- è‡¨æ™‚ QR Code ç™¼æ”¾
- QR Code æ™‚æ•ˆæ§åˆ¶
- èˆ‡ Soyal é–€ç¦ç³»çµ±æ•´åˆ

**ç›¸é—œ API**
- `GET /api/v1/TempQRCode/{userId}` - å–å¾—è‡¨æ™‚ QRcode
- `PUT /api/v1/TempQRCode` - æ›´æ–°è‡¨æ™‚ Qrcode è¨­å®š

**æ•´åˆèªªæ˜**
- é€é `SoyalAPI.SendUserAccessProfilesAsync()` èˆ‡é–€ç¦ç¡¬é«”ç³»çµ±é€šè¨Š
- QR Code åŒ…å«ä½¿ç”¨è€… IDã€æ¬Šé™ç¾¤çµ„ã€æœ‰æ•ˆæ™‚é–“ç­‰è³‡è¨Š
- æ”¯æ´å³æ™‚æ›´æ–°èˆ‡æ’¤éŠ·é€šè¡Œæ¬Šé™

### 4. èª²ç¨‹ç®¡ç†æ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- èª²ç¨‹åŸºæœ¬è³‡æ–™ç¶­è­·
- èª²ç¨‹é¡åˆ¥ç®¡ç†
- èª²ç¨‹æ”¶è²»è¨­å®š
- è€å¸«è³‡è¨Šç®¡ç†
- èª²ç¨‹èˆ‡é–€ç¦æ¬Šé™æ•´åˆ

**ç›¸é—œ API**
- `POST /api/v1/Courses` - å–å¾—æ‰€æœ‰èª²ç¨‹
- `POST /api/v1/Course` - æ–°å¢èª²ç¨‹
- `PUT /api/v1/Course` - æ›´æ–°èª²ç¨‹è³‡è¨Š
- `GET /api/v1/Teachers` - å–å¾—æ‰€æœ‰è€å¸«
- `POST /api/v1/CourseTypes` - å–å¾—æ‰€æœ‰èª²ç¨‹é¡åˆ¥
- `POST /api/v1/CourseType` - æ–°å¢èª²ç¨‹é¡åˆ¥
- `PUT /api/v1/CourseType` - æ›´æ–°èª²ç¨‹é¡åˆ¥
- `POST /api/v1/CoursePayments` - å–å¾—æ‰€æœ‰èª²ç¨‹æ”¶è²»è¨­å®š
- `POST /api/v1/CoursePayment` - æ–°å¢èª²ç¨‹æ”¶è²»è¨­å®š
- `PUT /api/v1/CoursePayment` - æ›´æ–°èª²ç¨‹æ”¶è²»è¨­å®š

**è³‡æ–™è¡¨**
- `TblCourse` - èª²ç¨‹è³‡è¨Š
- `TblCourseType` - èª²ç¨‹é¡åˆ¥
- `TblPayment` - èª²ç¨‹æ”¶è²»è¨­å®š
- `TblUser` (æ•™å¸«) - è€å¸«è³‡è¨Š

### 5. èª²ç¨‹æ’ç¨‹ç®¡ç†æ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- èª²è¡¨è¦åŠƒèˆ‡ç®¡ç†
- æ•™å®¤è³‡æºç®¡ç†
- æ‹–æ›³å¼èª²è¡¨ç·¨è¼¯
- è¦–è¦ºåŒ–è¡Œäº‹æ›†æª¢è¦– (æ—¥è¦–åœ–/æœˆè¦–åœ–)
- é€±æœŸæ€§èª²ç¨‹è¨­å®š (æ¯é€±/æ¯å…©é€±/å–®æ¬¡)
- èª²ç¨‹æ¨¡å¼ (ç¾å ´/è¦–è¨Š)
- èª²è¡¨èˆ‡é–€ç¦è‡ªå‹•æ•´åˆ

**ç›¸é—œ API**
- `POST /api/v1/Schedules` - å–å¾—èª²è¡¨æ¸…å–® (åˆ†é æŸ¥è©¢)
- `GET /api/v1/Schedule/{id}` - å–å¾—å–®ä¸€èª²è¡¨è©³ç´°è³‡è¨Š
- `POST /api/v1/Schedule/Test` - å»ºç«‹æ¸¬è©¦å­¸ç”Ÿèª²è¡¨
- `PUT /api/v1/Schedule` - æ›´æ–°èª²è¡¨
- `DELETE /api/v1/Schedule/{id}` - åˆªé™¤èª²è¡¨ (è»Ÿåˆªé™¤)
- `GET /api/v1/Schedule/Classroom/{classroomId}` - å–å¾—æ•™å®¤ç•¶æ—¥èª²è¡¨
- `GET /api/v1/Schedule/Student` - å–å¾—ç•¶å‰ç™»å…¥å­¸ç”Ÿçš„èª²è¡¨

**è³‡æ–™è¡¨**
- `TblSchedule` - èª²è¡¨è¨˜éŒ„
- `TblScheduleAttendance` - èª²è¡¨å‡ºå¸­é—œè¯
- `TblClassroom` - æ•™å®¤è³‡è¨Š

**å‰ç«¯å…ƒä»¶**
- `CourseScheduling.vue` - èª²è¡¨ç®¡ç†ä¸»é é¢
- ä½¿ç”¨ FullCalendar æä¾›äº’å‹•å¼èª²è¡¨ä»‹é¢
- æ”¯æ´æ‹–æ›³èª¿æ•´èª²ç¨‹æ™‚é–“èˆ‡æ•™å®¤
- æ›´æ–°æ¨¡å¼é¸æ“‡ (å–®æ¬¡/å¾ŒçºŒå…¨éƒ¨/å…¨éƒ¨)

### 6. æ•™å®¤ç®¡ç†æ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- æ•™å®¤è³‡è¨Šç¶­è­·
- æ•™å®¤å®¹é‡ç®¡ç†
- æ•™å®¤ä½¿ç”¨ç‹€æ³æŸ¥è©¢

**ç›¸é—œ API**
- `POST /api/v1/Classrooms` - å–å¾—æ‰€æœ‰æ•™å®¤
- `POST /api/v1/Classroom` - æ–°å¢æ•™å®¤
- `PUT /api/v1/Classroom` - æ›´æ–°æ•™å®¤è³‡è¨Š
- `GET /api/v1/Classroom/{id}` - å–å¾—å–®ä¸€æ•™å®¤è³‡è¨Š

**è³‡æ–™è¡¨**
- `TblClassroom` - æ•™å®¤è³‡è¨Š

### 7. ç°½åˆ°ç®¡ç†æ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- å­¸ç”Ÿç°½åˆ°è¨˜éŒ„
- å‡ºå¸­ç‹€æ³çµ±è¨ˆ
- æ‰£èª²æ™‚é–“ç®¡ç†
- è€å¸«é€²å‡ºè³‡æ–™æŸ¥è©¢

**ç›¸é—œ API**
- `POST /api/v1/Attendances` - ç°½åˆ°è¨˜éŒ„æŸ¥è©¢
- `POST /api/v1/Attendance` - æ–°å¢ç°½åˆ°è¨˜éŒ„
- `PUT /api/v1/Attendance` - æ›´æ–°ç°½åˆ°è¨˜éŒ„
- `PUT /api/v1/Attendance/DeductTime` - æ›´æ–°ä½¿ç”¨è€…æ‰£èª²æ™‚é–“
- `DELETE /api/v1/Attendance/DeductTime/{id}` - åˆªé™¤ä½¿ç”¨è€…æ‰£èª²ç´€éŒ„
- `GET /api/v1/Attendance/Teacher` - å–å¾—è€å¸«é€²å‡ºè³‡æ–™
- `GET /api/v1/Attendance/StudentStatus` - å–å¾—å­¸ç”Ÿé¸èª²ç‹€æ…‹çµ±è¨ˆ

**è³‡æ–™è¡¨**
- `TblAttendance` - ç°½åˆ°è¨˜éŒ„
- `TblScheduleAttendance` - èª²è¡¨å‡ºå¸­é—œè¯
- `TblAccessEventLog` - é–€ç¦é€²å‡ºäº‹ä»¶æ—¥èªŒ

### 8. ç¨½æ ¸æ—¥èªŒæ¨¡çµ„

**åŠŸèƒ½èªªæ˜**
- ç³»çµ±æ“ä½œè¨˜éŒ„
- ä½¿ç”¨è€…è¡Œç‚ºè¿½è¹¤
- è³‡æ–™è®Šæ›´æ­·ç¨‹

**è³‡æ–™è¡¨**
- `TblAuditLog` - ç¨½æ ¸æ—¥èªŒ

**å¯¦ä½œ**
- `AuditLogWritter.cs` - æ—¥èªŒè¨˜éŒ„å™¨
- è‡ªå‹•è¨˜éŒ„æ‰€æœ‰é‡è¦æ“ä½œ

## ğŸ”„ æ’ç¨‹ä»»å‹™ - QR Code è‡ªå‹•æ›´æ–°æ©Ÿåˆ¶

### ScheduledJob.cs æ ¸å¿ƒé‚è¼¯

**åŸ·è¡Œé »ç‡**: æ¯ 9 åˆ† 45 ç§’åŸ·è¡Œä¸€æ¬¡
è‡ªå‹•æ›´æ–°ç¬¦åˆæ¢ä»¶çš„ QR Code 
EX: 09:09:45 09:19:45 09:29:45 09:39:45 09:49:45 09:59:45

**ä¸»è¦åŠŸèƒ½**
1. æŸ¥è©¢ç•¶å‰æ™‚æ®µéœ€è¦é€šè¡Œçš„å­¸ç”Ÿèˆ‡æ•™å¸«
2. å‘¼å« Soyal API ç”¢ç”Ÿæˆ–æ›´æ–° QR Code
3. å°‡ QR Code è³‡è¨Šå„²å­˜è‡³è³‡æ–™åº«

**é‹ä½œæµç¨‹**

```plaintext
1. å–å¾—ç•¶å‰æ™‚é–“ + 15 ç§’ä½œç‚ºæ¯”å°åŸºæº–
2. è¨ˆç®— 10 åˆ†é˜æ™‚é–“çª—å£ (ææ—© 10 åˆ†é˜å•Ÿå‹•é–€ç¦)
3. æŸ¥è©¢ç¬¦åˆæ¢ä»¶çš„ TblStudentPermission è¨˜éŒ„:
   - æ—¥æœŸåœ¨æœ‰æ•ˆæœŸé–“å…§
   - æ˜ŸæœŸç¬¦åˆè¨­å®š
   - æ™‚æ®µåœ¨ç•¶å‰çª—å£å…§
   - æœ‰å°æ‡‰çš„ TblSchedule (ç•¶æ—¥èª²è¡¨)
   - æ’é™¤æ¸¬è©¦å¸³è™Ÿ (UserId 55, 56)
4. å»ºç«‹å­¸ç”Ÿèˆ‡æ•™å¸«çš„ UserAccessProfile æ¸…å–®
5. å‘¼å« SoyalAPI.SendUserAccessProfilesAsync() å–å¾— QR Code
6. æ›´æ–°æˆ–æ–°å¢ TblQRCodeStorage è¨˜éŒ„
7. è¨˜éŒ„åŸ·è¡Œæ—¥èªŒ
```

**é—œéµæŸ¥è©¢æ¢ä»¶**

```sql
-- æŸ¥è©¢ç¬¦åˆæ™‚æ®µçš„å­¸ç”Ÿæ¬Šé™
WHERE @nowDate BETWEEN p.DateFrom AND p.DateTo
  AND (  
       (TIME(@time) BETWEEN TIME(p.TimeFrom) AND TIME(p.TimeTo))
       OR
       (TIME(p.TimeFrom) BETWEEN TIME(@time) AND TIME(@Endtime))
      )
  AND p.IsDelete = 0 
  AND s.IsDelete = 0 
  AND p.Days LIKE CONCAT('%', @day, '%')
  AND @nowDate = ScheduleDate
  AND p.UserId NOT IN (55, 56)
```

**æ™‚é–“è™•ç†é‚è¼¯**
- `beginTime`: èª²ç¨‹é–‹å§‹æ™‚é–“ææ—© 10 åˆ†é˜ (è®“å­¸ç”Ÿæå‰å…¥å ´)
- `endTime`: èª²ç¨‹çµæŸæ™‚é–“
- ç¢ºä¿ QR Code åœ¨èª²ç¨‹æœŸé–“ä¿æŒæœ‰æ•ˆ

**æ•™å¸«é–€ç¦è™•ç†**
- è‹¥ `TblStudentPermission.TeacherId > 0`,åŒæ™‚å»ºç«‹æ•™å¸«çš„ QR Code
- æ•™å¸«èˆ‡å­¸ç”Ÿå…±ç”¨ç›¸åŒçš„é€šè¡Œæ™‚æ®µèˆ‡é–€ç¦ç¾¤çµ„

**å»é‡è™•ç†**
- ä½¿ç”¨ `GroupBy(x => x.userAddr)` ç¢ºä¿æ¯ä½ä½¿ç”¨è€…åªæœ‰ä¸€çµ„ QR Code

**éŒ¯èª¤è™•ç†**
- å®Œæ•´çš„ try-catch æ©Ÿåˆ¶
- è©³ç´°çš„æ—¥èªŒè¨˜éŒ„ (æˆåŠŸ/å¤±æ•—è³‡è¨Š)
- éŒ¯èª¤ä¸ä¸­æ–·å¾ŒçºŒè™•ç†

## ğŸ” é©—è­‰èˆ‡æˆæ¬Šæ©Ÿåˆ¶

### JWT (JSON Web Token) é©—è­‰

**è¨­å®šæª”æ¡ˆ**: `appsettings.json`
```json
{
  "JwtSettings": {
    "Issuer": "JwtAuthDemo",
    "SignKey": "1234567890123456"
  }
}
```

**é©—è­‰æµç¨‹**
1. ä½¿ç”¨è€…é€é `/api/v1/User/login` ç™»å…¥
2. ç³»çµ±é©—è­‰å¸³è™Ÿå¯†ç¢¼
3. ç”¢ç”Ÿ JWT Token (åŒ…å« UserId, Username, Role ç­‰è³‡è¨Š)
4. å‰ç«¯å„²å­˜ Token æ–¼ LocalStorage æˆ–è¨˜æ†¶é«”
5. å¾ŒçºŒ API è«‹æ±‚å¸¶å…¥ `Authorization: Bearer {token}` æ¨™é ­
6. å¾Œç«¯ä¸­ä»‹è»Ÿé«”é©—è­‰ Token æœ‰æ•ˆæ€§

**Token å…§å®¹**
- `sub`: ä½¿ç”¨è€…åç¨±
- `Id`: ä½¿ç”¨è€… ID
- `jti`: Token å”¯ä¸€è­˜åˆ¥ç¢¼
- `exp`: éæœŸæ™‚é–“
- `nbf`: ç”Ÿæ•ˆæ™‚é–“
- `iat`: ç°½ç™¼æ™‚é–“
- `iss`: ç°½ç™¼è€…

### æˆæ¬Šå±¬æ€§

**ç¨‹å¼ç¢¼ç¯„ä¾‹**
```csharp
[Authorize] // éœ€è¦é©—è­‰
public class UserController : ControllerBase
{
    // ...
}
```

## ğŸ—„ï¸ è³‡æ–™åº«çµæ§‹

### æ ¸å¿ƒè³‡æ–™è¡¨

**ä½¿ç”¨è€…ç›¸é—œ**
- `TblUser` - ä½¿ç”¨è€…ä¸»æª”
  - `Id`, `Account`, `Password`, `Name`, `Email`, `Phone`
  - `Type` - å¸³è™Ÿé¡å‹ (ç®¡ç†å“¡/è€å¸«/å­¸ç”Ÿ)
  - `RoleId` - è§’è‰² ID
  - `ParentUserId` - çˆ¶å¸³è™Ÿ ID (å­å¸³è™Ÿæ©Ÿåˆ¶)

**é–€ç¦ç›¸é—œ**
- `TblPermission` - å–®æ™‚æ®µé–€ç¦æ¬Šé™
- `TblStudentPermission` - å¤šæ™‚æ®µé–€ç¦æ¬Šé™
  - `UserId`, `TeacherId`, `ClassroomId`
  - `DateFrom`, `DateTo`, `TimeFrom`, `TimeTo`
  - `Days` - æ˜ŸæœŸè¨­å®š (å¦‚: "1,3,5")
  - `Type` - é–€ç¦ç¨®é¡ (1:ä¸Šèª², 2:ç§Ÿå€Ÿæ•™å®¤)
- `TblPermissionGroup` - é–€ç¦ç¾¤çµ„ (å°æ‡‰å¯¦é«”é–€)
- `TblQRCodeStorage` - QR Code å„²å­˜
  - `userTag`, `qrcodeTxt`, `QRCodeData`

**èª²ç¨‹ç›¸é—œ**
- `TblCourse` - èª²ç¨‹ä¸»æª”
- `TblCourseType` - èª²ç¨‹é¡åˆ¥
- `TblSchedule` - èª²è¡¨è¨˜éŒ„
  - `StudentPermissionId` (FK)
  - `ScheduleDate`, `StartTime`, `EndTime`
  - `ClassroomId`, `CourseId`, `TeacherId`
  - `ScheduleMode` - é€±æœŸæ¨¡å¼ (1:æ¯é€±, 2:æ¯å…©é€±, 3:å–®æ¬¡)
- `TblClassroom` - æ•™å®¤è³‡è¨Š
- `TblPayment` - èª²ç¨‹æ”¶è²»è¨­å®š

**ç°½åˆ°ç›¸é—œ**
- `TblAttendance` - ç°½åˆ°è¨˜éŒ„
- `TblScheduleAttendance` - èª²è¡¨å‡ºå¸­é—œè¯è¡¨
- `TblAccessEventLog` - é–€ç¦é€²å‡ºäº‹ä»¶æ—¥èªŒ

**ç³»çµ±ç›¸é—œ**
- `TblRole` - è§’è‰²å®šç¾©
- `TblAuditLog` - ç¨½æ ¸æ—¥èªŒ

### Entity Framework Migrations

è³‡æ–™åº«çµæ§‹è®Šæ›´é€é EF Core Migrations ç®¡ç†:
- `20240725012518_InitialCreate` - åˆå§‹è³‡æ–™åº«å»ºç«‹
- `20240905150526_addTypeToTblUser` - æ–°å¢ä½¿ç”¨è€…é¡å‹æ¬„ä½
- `20250501141415_Course` - èª²ç¨‹æ¨¡çµ„
- `20250603133743_AttendanceRelationTable` - ç°½åˆ°é—œè¯è¡¨
- å…¶ä»–é·ç§»æª”æ¡ˆè«‹åƒé–± `DoorDB/Migrations/` ç›®éŒ„

## ğŸ¨ å‰ç«¯æ¶æ§‹

### Vue 3 + TypeScript + Element Plus

**ä¸»è¦é é¢**
- `CourseScheduling.vue` - èª²ç¨‹æ’ç¨‹ç®¡ç†
  - ä½¿ç”¨ FullCalendar å…ƒä»¶
  - æ”¯æ´æ—¥è¦–åœ– / æœˆè¦–åœ–åˆ‡æ›
  - æ‹–æ›³ç·¨è¼¯èª²ç¨‹æ™‚é–“èˆ‡æ•™å®¤
  - æ•™å®¤ç¯©é¸åŠŸèƒ½

**è³‡æ–™æ¨¡å‹** (`src/models/`)
- `M_IClassRoomOptions` - æ•™å®¤é¸é …
- `M_IUsersOptions` - ä½¿ç”¨è€…é¸é …
- `M_ICourseOptions` - èª²ç¨‹é¸é …
- `M_ITeachersOptions` - è€å¸«é¸é …

**API å‘¼å«å±¤** (`src/apis/TPSAPI.ts`)
- å°è£æ‰€æœ‰å¾Œç«¯ API å‘¼å«
- çµ±ä¸€éŒ¯èª¤è™•ç†
- è«‹æ±‚/å›æ‡‰æ””æˆªå™¨

**UI å…ƒä»¶åº«**: Element Plus
- è¡¨å–®å…ƒä»¶ (el-form, el-input, el-select)
- å°è©±æ¡† (el-dialog)
- æ—¥æœŸæ™‚é–“é¸æ“‡å™¨ (el-date-picker, el-time-picker)
- è¨Šæ¯æç¤º (ElMessage)

## ğŸš€ éƒ¨ç½²èˆ‡è¨­å®š

### ç’°å¢ƒè®Šæ•¸

**appsettings.json è¨­å®šé …ç›®**
```json
{
  "ConnectionStrings": {
    "DoorDB": "server=localhost;database=doordb;user=root;password=xxx"
  },
  "JwtSettings": {
    "Issuer": "JwtAuthDemo",
    "SignKey": "your-secret-key-here"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information"
    }
  }
}
```

**å¤šç’°å¢ƒè¨­å®š**
- `appsettings.Development.json` - é–‹ç™¼ç’°å¢ƒ
- `appsettings.SIT.json` - ç³»çµ±æ•´åˆæ¸¬è©¦ç’°å¢ƒ
- `appsettings.UAT_MW.json` - ä½¿ç”¨è€…é©—æ”¶æ¸¬è©¦ç’°å¢ƒ

### Quartz.NET æ’ç¨‹è¨­å®š

**æ’ç¨‹è¨»å†Š** (Program.cs)
```csharp
builder.Services.AddQuartz(q =>
{
    q.UseMicrosoftDependencyInjectionJobFactory();
    
    var jobKey = new JobKey("ScheduledJob");
    q.AddJob<ScheduledJob>(opts => opts.WithIdentity(jobKey));
    
    q.AddTrigger(opts => opts
        .ForJob(jobKey)
        .WithIdentity("ScheduledJob-trigger")
        .WithCronSchedule("45 */10 * * * ?")); // æ¯ 10 åˆ†é˜çš„ç¬¬ 45 ç§’åŸ·è¡Œ
});

builder.Services.AddQuartzHostedService(q => q.WaitForJobsToComplete = true);
```

### NLog æ—¥èªŒè¨­å®š

**nlog.config** è¨­å®šæª”æ¡ˆä½æ–¼ `DoorWebApp/nlog.config`

**æ—¥èªŒè¼¸å‡º**
- Console è¼¸å‡º
- æª”æ¡ˆè¼¸å‡º (logs/ ç›®éŒ„)
- æ—¥èªŒç´šåˆ¥: Trace, Debug, Info, Warn, Error, Fatal

## ğŸ“ API æ–‡ä»¶

### Swagger UI

**å­˜å–è·¯å¾‘**: `http://localhost:8080/swagger`

ç³»çµ±æ•´åˆ Swagger UI,æä¾›äº’å‹•å¼ API æ–‡ä»¶èˆ‡æ¸¬è©¦ä»‹é¢ã€‚

### Postman Collection

å°ˆæ¡ˆåŒ…å«å®Œæ•´çš„ Postman Collection (`é–€ç¦.postman_collection.json`),æ¶µè“‹æ‰€æœ‰ API ç«¯é»ã€‚

**ä¸»è¦ API åˆ†é¡**
1. **ä½¿ç”¨è€…ç®¡ç†** (12 å€‹ç«¯é»)
2. **é–€ç¦æ¬Šé™ç®¡ç†** (9 å€‹ç«¯é»)
3. **QR Code ç®¡ç†** (3 å€‹ç«¯é»)
4. **èª²ç¨‹ç®¡ç†** (9 å€‹ç«¯é»)
5. **èª²ç¨‹æ’ç¨‹ç®¡ç†** (8 å€‹ç«¯é»)
6. **æ•™å®¤ç®¡ç†** (4 å€‹ç«¯é»)
7. **ç°½åˆ°ç®¡ç†** (8 å€‹ç«¯é»)
8. **è§’è‰²ç®¡ç†** (1 å€‹ç«¯é»)

**ç¸½è¨ˆ**: è¶…é 50 å€‹ API ç«¯é»

## ğŸ”§ é–‹ç™¼æŒ‡å—

### å¾Œç«¯é–‹ç™¼

**ç’°å¢ƒéœ€æ±‚**
- .NET SDK 6.0 æˆ–ä»¥ä¸Š
- MySQL 8.0 æˆ–ä»¥ä¸Š
- Visual Studio 2022 æˆ– Visual Studio Code

**åŸ·è¡Œæ­¥é©Ÿ**
```bash
# 1. é‚„åŸå¥—ä»¶
cd DoorWebApp
dotnet restore

# 2. æ›´æ–°è³‡æ–™åº«
cd ../DoorDB
dotnet ef database update

# 3. åŸ·è¡Œæ‡‰ç”¨ç¨‹å¼
cd ../DoorWebApp
dotnet run
```

**API é è¨­ä½å€**: `http://localhost:8080`

### å‰ç«¯é–‹ç™¼

**ç’°å¢ƒéœ€æ±‚**
- Node.js 16 æˆ–ä»¥ä¸Š
- npm æˆ– yarn

**åŸ·è¡Œæ­¥é©Ÿ**
```bash
# 1. å®‰è£ç›¸ä¾å¥—ä»¶
cd DoorWebApp_Vue
npm install

# 2. åŸ·è¡Œé–‹ç™¼ä¼ºæœå™¨
npm run serve

# 3. å»ºæ§‹æ­£å¼ç‰ˆæœ¬
npm run build
```

**é–‹ç™¼ä¼ºæœå™¨ä½å€**: `http://localhost:3000`

### æ–°å¢è³‡æ–™è¡¨

**Entity Framework Core Migration**
```bash
cd DoorDB
dotnet ef migrations add YourMigrationName
dotnet ef database update
```

### æ–°å¢ API ç«¯é»

1. åœ¨ `DoorWebApp/Controllers/` å»ºç«‹æˆ–ç·¨è¼¯ Controller
2. åŠ å…¥ `[Authorize]` å±¬æ€§é€²è¡Œé©—è­‰
3. å¯¦ä½œå•†æ¥­é‚è¼¯
4. æ›´æ–° Postman Collection
5. æ’°å¯«å–®å…ƒæ¸¬è©¦

## ğŸ› é™¤éŒ¯èˆ‡æ—¥èªŒ

### æ—¥èªŒæª”æ¡ˆä½ç½®

- **æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ**: `DoorWebApp/logs/`
- **æ’ç¨‹ä»»å‹™æ—¥èªŒ**: åŒ…å«åœ¨æ‡‰ç”¨ç¨‹å¼æ—¥èªŒä¸­,æœå°‹ "æ›´æ–° QRCode"


